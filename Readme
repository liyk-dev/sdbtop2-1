# SequoiaDB 集群管理工具

根据数据库管理员日常运维场景进行设计，使用菜单选择的交互方式，简化运维命令，使用二维表格的方式呈现，方便快速的进行浏览和比对。本工具可以帮助您：

+ 快速了解集群架构、状态、服务器资源

+ 数据库、表的定义，及数据分布、节点参数

+ 管理数据库会话，包括SQL层和存储层，提供 kill 会话的功能

+ 管理数据库事务，查看事务锁等待，访问计划的执行情况

+ 监控数据库的数据读写，表的热点分区

+ 查看数据库、表的空间占用情况

## 使用环境

经过验证，能够稳定运行在以下操作系统

+ Centos 6、Centos 7、Redhat 6、Redhat 7、SUSE 11、SUSE 12

经过验证，能够稳定运行在以下数据库版本

+ 3.2.*、3.4.*、5.0.*

## 工具下载

```shell
登录公司 gitlib, 搜索 sdbtop ,下载 sdbtop.tar.gz 安装文件
tar -zxvf sdbtop.tar.gz
cd sdbtop
```

修改当前目录下的.conf配置文件，执行./sdbtop 即可使用

## 配置项

需要修改以下连接配置

SDB连接配置

```txt
[sdb]
cluster_name = Test
# 协调节点地址，可配置多个，以逗号分隔
cluster_coord = 127.0.0.1:11810
cluster_user = sdbadmin
cluster_passwd = sdbadmin
query_timeout = 10
```

MySQL 连接配置(如果没安装mysql，可删除此处配置)

```txt
[mysql]
# MySQL地址，可配置多个，以逗号分隔
mysql_hosts = sdb
mysql_port = 3306
mysql_user = root
mysql_passwd = root
mysql_database = performance_schema
```

PostgreSQL 连接配置(如果没安装postgresql，可删除此处配置)

```txt
[postgresql]
# PostgreSQL地址，可配置多个，以逗号分隔
pg_hosts = sdb
pg_port = 5432
pg_user = sdbadmin
pg_passwd = sdbadmin
pg_database = postgres
```

## 功能介绍

主界面：

![image](https://user-images.githubusercontent.com/16267209/133196816-40c9e27e-23d6-4bba-a543-0633a85a3294.png)

工具的菜单入口：
| 菜单  |  说明 |
|  ----  | ----  |
| 查看集群拓扑结构  | 集群的部署结构，健康状态及软件安装和数据存储位置 |
| 查看集群资源  | 集群的服务器资源情况（CPU、内存、磁盘） |
| 查看资源元数据  | 域、库、表、索引的定义，节点的参数配置 |
| 查看数据库会话  | 数据库会话管理，实时查看数据库运行的SQL和任务 |
| 查看事务和锁  | 数据库的事务锁，执行计划 |
| 读写性能分析  | 分析数据库的压力分布 |
| 查看集群容量  | 数据库、表的磁盘空间占用情况 |

通用功能：

![sdbtop](https://user-images.githubusercontent.com/16267209/133203373-5aea8dfd-80bd-4a25-ad59-59492b871b0e.gif)


| 按键  | 功能 | 说明 |
|  ----  | ----  | ----  |
| 上下方向键 | 切换菜单项 | 菜单选择 |
| 回车  | 展示详情 | 进去子菜单或资源详情 |
| 左右方向键  | 数据分页 | 对列表进行分页显示 |
| 字符?  | 模糊搜索 | 按行内容进行模糊搜索 |
| 左右箭头  | 移动屏幕 | 移动屏幕显示更多的内容 |
| 字符q  | 返回上级菜单 | 返回上一层 |

查看集群拓扑结构：

![拓扑](https://user-images.githubusercontent.com/16267209/133204488-d5e96d2e-cd6b-43aa-bb37-91e7d1b1c06c.gif)

| 按键  | 功能 | 说明 |
|  ----  | ----  | ----  |
| 字符c | 切换显示模式 | 显示所有节点或只显示异常节点 |

查看集群物理资源：


| 按键  | 功能 | 说明 |
|  ----  | ----  | ----  |
| 字符c | 切换显示模式 | 显示所有节点或只显示异常节点 |

查看资源元数据：

| 菜单  |  说明 |
|  ----  | ----  |
| 数据域列表  | 展示集群数据域 |
| 集合空间列表  | 展示集群集合空间 |
| 集合列表  | 展示集合信息 |
| 序列列表  | 展示表的自增序列信息 |
| 配置列表  | 展示节点的配置信息 |

以集合列表为例：

![集合列表](https://user-images.githubusercontent.com/16267209/133207321-c137c87a-0aa9-4e41-a05a-8efbda45d201.gif)

| 按键  | 功能 | 说明 |
|  ----  | ----  | ----  |
| 字符m | 显示主表 | 仅显示集群的主表 |
| 字符s | 显示子表 | 默认子表是隐藏的，展示子表列表 |

查看数据库会话：
| 菜单  |  说明 |
|  ----  | ----  |
| MySQL 会话列表  | 展示MySQL实例组会话 |
| PostgreSQL 会话列表  | 展示PostgreSQL实例组会话 |
| SequoiaDB 会话列表  | 展示SequoiaDB会话 |
| SequoiaDB 上下文列表  | 展示SequoiaDB上下文信息 |


查看事务和锁：

| 菜单  |  说明 |
|  ----  | ----  |
| 事务锁列表  | 展示事务列表，及其持有的锁信息|
| 慢查询列表  | 展示数据库的慢会话|
| 访问计划列表  | 展示表的访问计划信息|

读写性能分析：


| 菜单  |  说明 |
|  ----  | ----  |
| 实时监控数据库读写  | 监控集群、主机、节点的读写压力情况  |
| 实时监控数据表读写  | 监控某张表在各个分区上的读写情况|
| 历史性能分析  | 分析一段时间内，数据库的读写情况 |

查看集群容量


| 按键  | 功能 | 说明 |
|  ----  | ----  | ----  |
| 字符c | 切换排序方式 | 按记录数/容量排序 |
